<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>煤矿设备检修辅助系统</title>
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/element-plus/dist/index.full.min.js"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
</head>
<body>
  <!--
    单独使用说明：本页面不依赖任何后端接口，仅通过 WebSocket 接收并展示数据。
    请在下方脚本中的 WS_URL 处填写你的 WebSocket 地址；
    也可在加载本页前设置 window.WS_URL 覆盖（例如在另一个 script 标签中）。
  -->
  <div id="app"></div>

  <script>
    (function () {
    const Vue = window.Vue;
    const ElementPlus = window.ElementPlus;
    const { createApp, ref, computed, onMounted, onBeforeUnmount, watch, nextTick } = Vue;

    // ========== WebSocket 地址：可直接改此处，或用 window.WS_URL 覆盖 ==========
    const WS_URL = 'ws://127.0.0.1:8050/ws/subscribe';

    const RECOGNITION_CLASS_MAP = {
      integrated_machine_drive_end_top_cover: ['一体机驱动端顶部盖板', [153, 138, 30]],
      integrated_machine_motor: ['一体机电机', [71, 157, 204]],
      integrated_machine_control_cabinet: ['一体机控制箱', [25, 73, 127]],
      integrated_machine_dc_bus_indicator_window: ['一体机直流母线指示窗', [63, 127, 71]],
      integrated_machine_mobile_substation: ['一体机移动变电站', [78, 63, 127]],
      integrated_machine_cooling_water_inlet: ['一体机冷却水进水口', [122, 44, 127]],
      integrated_machine_cooling_water_outlet: ['一体机冷却水出水口', [102, 204, 168]],
      shearer_drum: ['采煤机滚筒', [89, 178, 62]],
      shearer_rocker_arm: ['采煤机摇臂', [44, 127, 112]],
      shearer_haulage_unit: ['采煤机牵引部', [50, 204, 40]],
      shearer_cutting_wheel: ['采煤机截割轮', [119, 35, 178]],
      shearer_scraper_conveyor: ['采煤机刮板输送机', [35, 178, 102]]
    };

    const normalizeClassKey = (key) => key.trim().toLowerCase().replace(/\s+/g, '_');
    const findClassInMap = (className) => {
      if (RECOGNITION_CLASS_MAP[className]) return RECOGNITION_CLASS_MAP[className];
      const normalized = normalizeClassKey(className);
      for (const key in RECOGNITION_CLASS_MAP) {
        if (normalizeClassKey(key) === normalized) return RECOGNITION_CLASS_MAP[key];
      }
      return null;
    };
    const translateClassName = (className) => {
      const item = findClassInMap(className);
      return item ? item[0] : className;
    };
    const getClassColor = (className) => {
      const item = findClassInMap(className);
      if (!item) return '';
      const [r, g, b] = item[1];
      return `rgb(${r}, ${g}, ${b})`;
    };

    const MAX_WS_DATA_LIST_SIZE = 100;

    createApp({
      setup() {
        const ws = ref(null);
        const wsConnectionStatus = ref('disconnected');
        const wsDataList = ref([]);
        const selectedDataIndex = ref(-1);
        const imageRef = ref(null);
        const canvasRef = ref(null);
        let resizeObserver = null;

        const selectedData = computed(() => {
          if (selectedDataIndex.value >= 0 && selectedDataIndex.value < wsDataList.value.length) {
            return wsDataList.value[selectedDataIndex.value].data;
          }
          return null;
        });

        const selectedImageData = computed(() => {
          if (!selectedData.value || !selectedData.value.image_data) return '';
          const d = selectedData.value.image_data;
          return d.startsWith('data:image') ? d : `data:image/jpeg;base64,${d}`;
        });

        const wsStatusText = computed(() => {
          switch (wsConnectionStatus.value) {
            case 'connected': return '已连接';
            case 'connecting': return '连接中...';
            case 'disconnected': return '未连接';
            default: return '未知';
          }
        });

        function getImageSrcFromWSData(imageData) {
          if (!imageData) return '';
          return imageData.startsWith('data:image') ? imageData : `data:image/jpeg;base64,${imageData}`;
        }

        function connectWebSocket() {
          try {
            if (!WS_URL || typeof WS_URL !== 'string') {
              ElementPlus.ElMessage.error('请配置 WebSocket 地址（修改本文件中 WS_URL 或设置 window.WS_URL）');
              return;
            }
            if (ws.value) {
              ws.value.close();
              ws.value = null;
            }
            wsConnectionStatus.value = 'connecting';
            ws.value = new WebSocket(WS_URL);
            ws.value.onopen = () => {
              wsConnectionStatus.value = 'connected';
              ElementPlus.ElMessage.success('WebSocket 连接已建立');
            };
            ws.value.onmessage = (event) => {
              try {
                const data = JSON.parse(event.data);
                handleWSData(data);
              } catch (e) {
                ElementPlus.ElMessage.error('接收数据格式错误');
              }
            };
            ws.value.onerror = () => {
              ElementPlus.ElMessage.error('WebSocket 连接错误');
              wsConnectionStatus.value = 'disconnected';
            };
            ws.value.onclose = () => {
              wsConnectionStatus.value = 'disconnected';
              ElementPlus.ElMessage.warning('WebSocket 连接已断开');
            };
          } catch (error) {
            ElementPlus.ElMessage.error('连接 WebSocket 失败：' + (error && error.message ? error.message : '请检查地址与网络'));
            wsConnectionStatus.value = 'disconnected';
          }
        }

        function formatTimestamp(ts) {
          if (!ts) return '-';
          try {
            return new Date(ts).toLocaleString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit'
            });
          } catch (e) {
            return ts;
          }
        }

        function formatBoundingBox(box) {
          if (!box || !box.points || box.points.length !== 4) return '-';
          const labels = ['左上', '右上', '右下', '左下'];
          return box.points.map((point, i) => `${labels[i]}: (${(point.x * 100).toFixed(1)}%, ${(point.y * 100).toFixed(1)}%)`).join('; ');
        }

        function handleWSData(data) {
          const dataItem = {
            id: data.image_id || 'data-' + Date.now() + '-' + Math.random().toString(36).slice(2, 11),
            data: { ...data },
            receiveTime: Date.now()
          };
          wsDataList.value.push(dataItem);
          if (wsDataList.value.length > MAX_WS_DATA_LIST_SIZE) {
            wsDataList.value.splice(0, wsDataList.value.length - MAX_WS_DATA_LIST_SIZE);
          }
          selectedDataIndex.value = wsDataList.value.length - 1;
          setTimeout(() => {
            const container = document.querySelector('.data-list-container');
            if (container) container.scrollTop = container.scrollHeight;
          }, 100);
        }

        function selectDataItem(index) {
          if (index >= 0 && index < wsDataList.value.length) selectedDataIndex.value = index;
        }

        function clearDataList() {
          ElementPlus.ElMessageBox.confirm('确定要清空所有数据吗？', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            wsDataList.value = [];
            selectedDataIndex.value = -1;
            ElementPlus.ElMessage.success('数据已清空');
          }).catch(() => {});
        }

        function closeWebSocket() {
          if (ws.value) {
            ws.value.close();
            ws.value = null;
          }
          wsConnectionStatus.value = 'disconnected';
        }

        function reconnectWebSocket() {
          closeWebSocket();
          ElementPlus.ElMessage.info('正在重新连接...');
          connectWebSocket();
        }

        function drawBoundingBoxes() {
          nextTick(() => {
            const img = imageRef.value;
            const canvas = canvasRef.value;
            const sel = selectedData.value;
            if (!img || !canvas || !sel) return;
            const ctx = canvas.getContext('2d');
            if (!ctx) return;
            if (!img.complete || img.naturalWidth === 0 || img.naturalHeight === 0) {
              img.onload = () => drawBoundingBoxes();
              return;
            }
            const imgRect = img.getBoundingClientRect();
            const displayWidth = imgRect.width;
            const displayHeight = imgRect.height;
            if (displayWidth === 0 || displayHeight === 0) return;
            const canvasWrapper = canvas.parentElement;
            if (!canvasWrapper) return;
            const wrapperRect = canvasWrapper.getBoundingClientRect();
            const imgOffsetX = imgRect.left - wrapperRect.left;
            const imgOffsetY = imgRect.top - wrapperRect.top;
            const dpr = window.devicePixelRatio || 1;
            canvas.width = displayWidth * dpr;
            canvas.height = displayHeight * dpr;
            canvas.style.width = displayWidth + 'px';
            canvas.style.height = displayHeight + 'px';
            canvas.style.left = imgOffsetX + 'px';
            canvas.style.top = imgOffsetY + 'px';
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, displayWidth, displayHeight);
            const scaleX = displayWidth / img.naturalWidth;
            const scaleY = displayHeight / img.naturalHeight;
            const fallbackColors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#FFA500', '#800080'];
            if (sel.recognition_results?.length) {
              sel.recognition_results.forEach((result, index) => {
                if (!result.bounding_box?.points || result.bounding_box.points.length !== 4) return;
                const color = getClassColor(result.class_name) || fallbackColors[index % fallbackColors.length];
                const points = result.bounding_box.points.map((p) => ({
                  x: p.x * img.naturalWidth * scaleX,
                  y: p.y * img.naturalHeight * scaleY
                }));
                ctx.beginPath();
                ctx.moveTo(points[0].x, points[0].y);
                for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);
                ctx.closePath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.stroke();
                const labelText = translateClassName(result.class_name);
                ctx.font = 'bold 14px Arial';
                const lw = ctx.measureText(labelText).width + 10;
                const lh = 24;
                const lx = points[0].x;
                const ly = Math.max(points[0].y - 5, lh);
                ctx.fillStyle = color;
                ctx.fillRect(lx, ly - lh, lw, lh);
                ctx.fillStyle = '#FFFFFF';
                ctx.fillText(labelText, lx + 5, ly - 5);
              });
            }
          });
        }

        function handleResize() {
          if (selectedImageData.value && selectedData.value) {
            requestAnimationFrame(() => drawBoundingBoxes());
          }
        }

        function setupResizeObserver() {
          if (!imageRef.value || !canvasRef.value) return;
          if (resizeObserver) resizeObserver.disconnect();
          resizeObserver = new ResizeObserver(() => handleResize());
          resizeObserver.observe(imageRef.value);
          const wrapper = canvasRef.value.parentElement;
          if (wrapper) resizeObserver.observe(wrapper);
        }

        function onImageError() {
          ElementPlus.ElMessage.error('设备图片加载失败，请检查图片路径');
        }

        watch([selectedData, selectedImageData], () => {
          if (selectedImageData.value && selectedData.value) {
            nextTick(() => {
              if (resizeObserver) resizeObserver.disconnect();
              setupResizeObserver();
              drawBoundingBoxes();
            });
          }
        }, { deep: true });

        onMounted(() => {
          window.addEventListener('resize', handleResize);
          nextTick(() => setupResizeObserver());
          ElementPlus.ElMessage.info('正在连接 WebSocket...');
          connectWebSocket();
        });

        onBeforeUnmount(() => {
          if (resizeObserver) { resizeObserver.disconnect(); resizeObserver = null; }
          closeWebSocket();
          window.removeEventListener('resize', handleResize);
        });

        return {
          wsConnectionStatus,
          wsDataList,
          selectedDataIndex,
          selectedData,
          selectedImageData,
          wsStatusText,
          imageRef,
          canvasRef,
          closeWebSocket,
          reconnectWebSocket,
          clearDataList,
          selectDataItem,
          formatTimestamp,
          formatBoundingBox,
          translateClassName,
          drawBoundingBoxes,
          onImageError
        };
      },
      template: `
<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">煤矿设备检修辅助系统</h1>
    <p class="page-description">混合现实设备巡检，沉浸式设备状态监控与维护指导</p>
  </div>

  <div class="content-card">
    <div class="card-header">
      <div class="card-title">
        <iconify-icon icon="fa:cube"></iconify-icon> MR 巡检数据接收
      </div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <el-tag :type="wsConnectionStatus === 'connected' ? 'success' : wsConnectionStatus === 'connecting' ? 'warning' : 'danger'">
          {{ wsStatusText }}
        </el-tag>
        <el-button @click="reconnectWebSocket">
          <iconify-icon icon="fa:sync-alt"></iconify-icon> 重新连接
        </el-button>
        <el-button type="primary" @click="closeWebSocket">
          <iconify-icon icon="fa:unlink"></iconify-icon> 断开连接
        </el-button>
      </div>
    </div>
      <div class="card-content">
        <div class="inspection-layout">
          <div class="data-list-panel">
            <div class="data-list-header">
              <h3>数据列表 ({{ wsDataList.length }})</h3>
              <el-button type="danger" size="small" :disabled="wsDataList.length === 0" @click="clearDataList">
                <iconify-icon icon="fa:trash"></iconify-icon> 清空数据
              </el-button>
            </div>
            <div class="data-list-container">
              <div v-if="wsDataList.length === 0" class="empty-data-list">
                <iconify-icon icon="fa:inbox" style="font-size: 48px; color: #ccc;"></iconify-icon>
                <p>暂无数据，等待接收...</p>
              </div>
              <div
                v-for="(item, index) in wsDataList"
                :key="item.id"
                class="data-list-item"
                :class="{ active: selectedDataIndex === index }"
                @click="selectDataItem(index)"
              >
                <div class="data-item-header">
                  <span class="data-item-index">#{{ index + 1 }}</span>
                  <el-tag :type="item.data.status === 'success' ? 'success' : 'danger'" size="small">
                    {{ item.data.status === 'success' ? '成功' : '失败' }}
                  </el-tag>
                </div>
                <div class="data-item-info">
                  <div class="data-item-row">
                    <span class="data-item-label">时间:</span>
                    <span class="data-item-value">{{ formatTimestamp(item.data.timestamp) }}</span>
                  </div>
                  <div class="data-item-row">
                    <span class="data-item-label">操作:</span>
                    <span class="data-item-value">{{ item.data.operation_type }}</span>
                  </div>
                  <div class="data-item-row">
                    <span class="data-item-label">目标类:</span>
                    <span class="data-item-value">{{ translateClassName(item.data.target_class) }}</span>
                  </div>
                  <div class="data-item-row" v-if="item.data.recognition_results && item.data.recognition_results.length > 0">
                    <span class="data-item-label">识别数:</span>
                    <span class="data-item-value">{{ item.data.recognition_results.length }} 个</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="data-detail-panel">
            <div v-if="selectedData" class="data-detail-content">
              <div class="inspection-viewer">
                <div class="device-image-container">
                  <div v-if="selectedImageData" class="canvas-wrapper">
                    <img
                      ref="imageRef"
                      :src="selectedImageData"
                      alt="设备巡检图片"
                      class="device-image"
                      @load="drawBoundingBoxes"
                      @error="onImageError"
                    />
                    <canvas ref="canvasRef" class="bounding-box-canvas"></canvas>
                  </div>
                  <div v-else class="no-image-placeholder">
                    <iconify-icon icon="fa:image" style="font-size: 48px; color: #666;"></iconify-icon>
                    <p>无图片数据</p>
                  </div>
                </div>
              </div>

              <div class="recognition-results">
                <div class="results-header">
                  <h3>识别结果详情</h3>
                  <el-tag :type="selectedData.status === 'success' ? 'success' : 'danger'">
                    {{ selectedData.status === 'success' ? '识别成功' : '识别失败' }}
                  </el-tag>
                </div>
                <div class="results-info">
                  <div class="info-item">
                    <span class="info-label">设备ID:</span>
                    <span class="info-value">{{ selectedData.device_id }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">用户ID:</span>
                    <span class="info-value">{{ selectedData.user_id }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">故障ID:</span>
                    <span class="info-value">{{ selectedData.fault_id }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">操作类型:</span>
                    <span class="info-value">{{ selectedData.operation_type }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">目标类:</span>
                    <span class="info-value">{{ translateClassName(selectedData.target_class) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">故障状态:</span>
                    <el-tag :type="selectedData.fault_status ? 'success' : 'warning'">
                      {{ selectedData.fault_status ? '已解决' : '未解决' }}
                    </el-tag>
                  </div>
                  <div class="info-item" v-if="selectedData.fault_description">
                    <span class="info-label">故障描述:</span>
                    <span class="info-value">{{ selectedData.fault_description }}</span>
                  </div>
                  <div class="info-item" v-if="selectedData.troubleshoot_step">
                    <span class="info-label">排障步骤:</span>
                    <span class="info-value">{{ selectedData.troubleshoot_step }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">图片ID:</span>
                    <span class="info-value">{{ selectedData.image_id }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">时间戳:</span>
                    <span class="info-value">{{ formatTimestamp(selectedData.timestamp) }}</span>
                  </div>
                </div>
                <div v-if="selectedData.recognition_results && selectedData.recognition_results.length > 0" class="recognition-list">
                  <h4>识别到的目标 ({{ selectedData.recognition_results.length }}):</h4>
                  <div class="recognition-items">
                    <div v-for="(result, index) in selectedData.recognition_results" :key="index" class="recognition-item">
                      <div class="recognition-item-header">
                        <span class="class-name">{{ translateClassName(result.class_name) }}</span>
                        <el-tag :type="result.confidence > 0.7 ? 'success' : result.confidence > 0.5 ? 'warning' : 'danger'">
                          置信度: {{ (result.confidence * 100).toFixed(2) }}%
                        </el-tag>
                      </div>
                      <div v-if="result.bounding_box" class="bounding-box-info">
                        <span>边界框坐标:</span>
                        <span class="coordinates">{{ formatBoundingBox(result.bounding_box) }}</span>
                      </div>
                      <div v-if="result.attributes" class="attributes-info">
                        <span>属性信息:</span>
                        <pre>{{ JSON.stringify(result.attributes, null, 2) }}</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-else class="no-selected-data">
              <iconify-icon icon="fa:hand-pointer" style="font-size: 64px; color: #ccc;"></iconify-icon>
              <p>请从左侧列表中选择一条数据查看详情</p>
            </div>
          </div>
        </div>
      </div>
  </div>
</div>
      `
    })
      .use(ElementPlus)
      .mount('#app');
    })();
  </script>

  <style>
    :root {
      --primary-color: #409EFF;
      --success-color: #67C23A;
      --warning-color: #E6A23C;
      --danger-color: #F56C6C;
      --text-primary: #303133;
      --text-secondary: #606266;
      --text-tertiary: #909399;
      --border-color: #EBEEF5;
      --bg-color: #F5F7FA;
    }
    .page-container { width: 100%; margin: 0; padding: 20px; box-sizing: border-box; min-height: 100vh; max-height: 100vh; overflow-y: auto; font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; background: var(--bg-color); }
    .page-header { background: white; padding: 24px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1); }
    .page-title { font-size: 24px; font-weight: 600; color: #303133; margin: 0 0 8px 0; }
    .page-description { color: #606266; font-size: 14px; margin: 0; }
    .content-card { background: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08); overflow: hidden; }
    .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); background: #fafafa; display: flex; justify-content: space-between; align-items: center; }
    .card-title { font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 8px; }
    .card-content { padding: 24px; }
    .inspection-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; min-height: 600px; }
    .data-list-panel { background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); display: flex; flex-direction: column; overflow: hidden; }
    .data-list-header { padding: 16px; background: white; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .data-list-header h3 { margin: 0; font-size: 16px; font-weight: 600; color: var(--text-primary); }
    .data-list-container { flex: 1; overflow-y: auto; padding: 12px; max-height: calc(100vh - 300px); scrollbar-width: none; -ms-overflow-style: none; }
    .data-list-container::-webkit-scrollbar { display: none; }
    .empty-data-list { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; color: #999; }
    .empty-data-list p { margin-top: 16px; font-size: 14px; }
    .data-list-item { background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
    .data-list-item:hover { border-color: var(--primary-color); box-shadow: 0 2px 8px rgba(64, 158, 255, 0.15); }
    .data-list-item.active { border-color: var(--primary-color); background: #ecf5ff; box-shadow: 0 2px 8px rgba(64, 158, 255, 0.2); }
    .data-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .data-item-index { font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .data-item-info { display: grid; gap: 6px; }
    .data-item-row { display: flex; font-size: 12px; }
    .data-item-row .data-item-label { color: var(--text-secondary); min-width: 60px; margin-right: 8px; }
    .data-item-row .data-item-value { color: var(--text-primary); flex: 1; word-break: break-all; }
    .data-detail-panel { background: white; border-radius: 8px; border: 1px solid var(--border-color); overflow-y: auto; max-height: calc(100vh - 300px); }
    .data-detail-content { padding: 0; }
    .no-selected-data { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 500px; color: #999; }
    .no-selected-data p { margin-top: 16px; font-size: 14px; }
    .device-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
    .device-card { border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; transition: all 0.3s; cursor: pointer; background: white; }
    .device-card:hover { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12); transform: translateY(-2px); }
    .device-header { padding: 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .device-name { font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0; }
    .device-body { padding: 16px; }
    .device-info { display: grid; gap: 8px; margin-bottom: 16px; }
    .info-row { display: flex; justify-content: space-between; font-size: 14px; }
    .info-label { color: var(--text-secondary); }
    .info-value { color: var(--text-primary); font-weight: 500; }
    .device-actions { display: flex; gap: 8px; justify-content: center; }
    .mr-button { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; padding: 8px 16px; cursor: pointer; transition: all 0.3s; font-size: 12px; display: inline-flex; align-items: center; gap: 4px; }
    .mr-button:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .mr-button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .inspection-viewer { background: #1a1a1a; border-radius: 12px; position: relative; margin-bottom: 20px; overflow: hidden; }
    .device-image-container { position: relative; width: 100%; min-height: 500px; display: flex; align-items: center; justify-content: center; padding: 20px; background: #1a1a1a; }
    .canvas-wrapper { position: relative; display: inline-block; max-width: 90%; max-height: 460px; }
    .device-image { max-height: 460px; max-width: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 0 30px rgba(64, 158, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); display: block; }
    .bounding-box-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; border-radius: 8px; }
    .no-image-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 460px; color: #999; }
    .no-image-placeholder p { margin-top: 16px; font-size: 14px; }
    .recognition-results { background: white; border-radius: 12px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08); }
    .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); }
    .results-header h3 { margin: 0; font-size: 18px; font-weight: 600; color: var(--text-primary); }
    .results-info { display: grid; gap: 12px; margin-bottom: 20px; }
    .info-item { display: flex; align-items: center; font-size: 14px; }
    .info-item .info-label { color: var(--text-secondary); min-width: 100px; margin-right: 12px; }
    .info-item .info-value { color: var(--text-primary); font-weight: 500; flex: 1; }
    .recognition-list { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); }
    .recognition-list h4 { margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: var(--text-primary); }
    .recognition-items { display: grid; gap: 16px; }
    .recognition-item { padding: 16px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); }
    .recognition-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .recognition-item-header .class-name { font-size: 16px; font-weight: 600; color: var(--text-primary); }
    .bounding-box-info { margin-top: 8px; font-size: 13px; color: var(--text-secondary); }
    .bounding-box-info .coordinates { margin-left: 8px; color: var(--text-primary); }
    .attributes-info { margin-top: 8px; font-size: 13px; color: var(--text-secondary); }
    .attributes-info pre { margin: 8px 0 0 0; padding: 8px; background: white; border-radius: 4px; border: 1px solid var(--border-color); font-size: 12px; color: var(--text-primary); overflow-x: auto; }
    .filter-section { background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08); }
    @media (max-width: 768px) { .device-grid { grid-template-columns: 1fr; } }
  </style>
</body>
</html>
